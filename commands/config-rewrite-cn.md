这`CONFIG REWRITE`命令重写`redis.conf`文件启动服务器时，应用所需的最少更改，使其反映服务器当前使用的配置，由于使用了`CONFIG SET`命令。

重写以非常保守的方式执行：

*   注释和原始 redis.conf 的整体结构尽可能保留。
*   如果旧的 redis.conf 文件中已存在某个选项，则该选项将在相同位置（行号）重写。
*   如果某个选项尚不存在，但已设置为其默认值，则重写过程不会添加该选项。
*   如果某个选项尚不存在，但该选项已设置为非默认值，则会将其追加在文件末尾。
*   未使用的行被遮蔽。例如，如果您曾经有多个`save`指令，但当前配置具有较少或没有，因为您禁用了 RDB 持久性，所有行都将被遮蔽。

CONFIG REWRITE还能够从头开始重写配置文件，如果原始文件由于某种原因不再存在。但是，如果服务器在没有配置文件的情况下启动，则配置重写将只返回错误。

## 原子重写过程

为了确保 redis.conf 文件始终保持一致，也就是说，在发生错误或崩溃时，您始终以旧文件或新文件结尾，重写是使用单个文件执行的`write(2)`具有足够内容的调用，至少与旧文件一样大。有时，以注释的形式添加其他填充，以确保生成的文件足够大，然后文件被截断以删除末尾的填充。

@return

@simple字符串回复：`OK`当配置正确重写时。
否则，将返回错误。
