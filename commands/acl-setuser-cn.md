使用指定的规则创建 ACL 用户或修改
现有用户。这是操作 Redis ACL 的主接口
用户交互：如果用户名不存在, 则该命令将创建
没有任何权限的用户名, 然后从左到右读取所有
规则作为连续参数提供, 按指定设置用户 ACL 规则。

如果用户已存在, 则只需应用提供的 ACL 规则
*另外*到已设置的规则。例如：

    ACL SETUSER virginia on allkeys +set

上面的命令将创建一个名为`virginia`处于活动状态
 (on 规则,  , 可以访问任何键 (allkeys , 则) , 并且可以调用
设置命令 (+设置规) ) , 然后, 另一个 SETUSER 调用可以修改用户规则：

    ACL SETUSER virginia +get

上述规则不会将新规则应用于用户 virginia, 因此除了`SET`, 用户弗吉尼亚现在还可以使用`GET`命令。

从 Redis 7.0 开始, ACL 规则还可以分组到多个不同的规则集 (称为选择) ) 中。
选择器是通过将规则括在括号中并像任何其他规则一样提供它们来添加的。
为了执行命令, root 权限 (在括号外定义的规) ) 或任何选择器 (在括号内定义的) 则) 必须与给定的命令匹配。
例如：

    ACL SETUSER virginia on +GET allkeys (+SET ~app1*)

这将为用户设置两组权限, 一组在用户上定义, 另一组使用选择器定义。
root 用户权限仅允许执行 get 命令, 但可以在任何键上执行。
然后, 选择器授予一组辅助权限：对`SET`命令, 在以“app1”开头的任何键上执行。
使用多个选择器允许您根据要访问的密钥授予不同的权限。

当我们想要确保从头开始定义用户时, 而不用担心
它以前定义了相关的规则, 我们可以使用特殊规则
`reset`作为第一条规则, 为了刷新所有其他现有规则：

    ACL SETUSER antirez reset [... other rules ...]

重置用户后, 它将返回到其时的状态
刚刚创建：非活动 (关闭规), ) , 无法执行任, 命令, 无法执行
访问任意键：

    > ACL SETUSER antirez reset
    +OK
    > ACL LIST
    1) "user antirez off -@all"

ACL 规则可以是“开”、“关”、“重置”、“所有键”等词, 也可以是
以特殊字符开头的特殊规则, 后跟
另一个字符串 (中间没有任何空), ) , 如“+SET”。

以下文档是关于此命令功能的参考手册, 但是我们的[ACL 教程](/topics/acl)可能是对ACL系统一般工作原理的更温和的介绍。

## 规则列表

Redis ACL 规则分为两类：定义命令权限的规则“命令规则”和定义用户状态的规则“用户管理规则”。
以下是所有受支持的 Redis ACL 规则的列表：

### 命令规则

*   `~<pattern>`：添加指定的键模式 (glob样式模, , 如在`KEYS`命), ) , 以列出用户可访问的关键模式。这将向与模式匹配的密钥授予读取和写入权限。您可以为同一用户添加多个键模式。例：`~objects:*`
*   `%R~<pattern>`： (在 Redis 7.0 及更高版本中可) ) 添加指定的读取键模式。这类似于常规密, 模式, 但仅授予读取与给定模式匹配的密钥的权限。看[密钥权限](/topics/acl#key-permissions)了解更多信息。
*   `%W~<pattern>`： (在 Redis 7.0 及更高版本中可) ) 添加指定的写入密钥模式。这类似于常规密, 模式, 但仅授予写入与给定模式匹配的密钥的权限。看[密钥权限](/topics/acl#key-permissions)了解更多信息。
*   `%RW~<pattern>`： (在 Redis 7.0 及更高版本中可) ) 别名`~<pattern>`.
*   `allkeys`：别名`~*`, 它允许用户访问所有密钥。
*   `resetkeys`：从用户可以访问的键模式列表中删除所有键模式。
*   `&<pattern>`： (在 Redis 6.2 及更高版本中可) ) 将指定的 glob 样式模式添加到用户可访问的发布/订阅通道模式列表中。您可以为同一用户添加多个通道模式。例：`&chatroom:*`
*   `allchannels`：别名`&*`, 它允许用户访问所有发布/订阅频道。
*   `resetchannels`：从用户可以访问的发布/订阅通道模式列表中删除所有通道模式。
*   `+<command>`：将命令添加到用户可以调用的命令列表中。可与`|`用于允许子命令 (例如“+config|get) ) 。
*   `+@<category>`：将指定类别中的所有命令添加到用户能够执行的命令列表中。例：`+@string` (添加所有字符串命) ) 。有关类, 列表, 请查看`ACL CAT`命令。
*   `+<command>|first-arg`：允许以其他方式禁用的命令的特定第一个参数。它仅在没有子命令的命令上受支持, 并且不允许作为负形式 (如 -SELECT|), ) , 仅以“+”开头的加法。此功能, 弃用, 将来可能会被删除。
*   `allcommands`：别名`+@all`.添加服务器中的所有命令, 包括*将来的命令*通过模块加载, 由此用户执行。
*   `-<command>`：将命令删除到用户可以调用的命令列表中。从 Redis 7.0 开始, 它可以与`|`用于阻塞子命令 (例如“-config|set) ) 。
*   `-@<category>`： 赞`+@<category>`但会删除类别中的所有命令, 而不是添加它们。
*   `nocommands`：别名`-@all`.删除所有命令, 用户将无法再执行任何内容。

### 用户管理规则

*   `on`：将用户设置为活动状态, 可以使用以下命令进行身份验证`AUTH <username> <password>`.
*   `off`：将用户设置为不活动, 将无法以此用户身份登录。请注意, 如果在已与此类用户进行身份验证后, 用户被禁用 (设置为关), ) , 则连接将继续按预期工作。还要终止您可以使用的旧连接`CLIENT KILL`与用户选项。另一种方法是删除用户`ACL DELUS, R`, 这将导致所有被验证为已删除用户的连接断开连接。
*   `nopass`：用户被设置为“无密码”用户。这意味着可以使用任何密码作为此类用户进行身份验证。默认情况下, `default`特殊用户设置为“nopass”。这`nopass`规则还将重置用户的所有已配置密码。
*   `>password`：将指定的明文密码添加为哈希密码添加到用户密码列表中。每个用户都可以有许多活动密码, 因此密码轮换将更简单。指定的密码不会作为明文存储在服务器中。例：`>mypassword`.
*   `#<hashedpassword>`：将指定的哈希密码添加到用户密码列表中。Redis 哈希密码使用 SHA256 进行哈希处理, 并转换为十六进制字符串。例：`#c3ab8ff13720e8ad9047dd39466b3c8974e592c2fa383d4a3960714caef0c4f2`.
*   `<password`： 赞`>password`但删除密码而不是添加密码。
*   `!<hashedpassword>`： 赞`#<hashedpassword>`但删除密码而不是添加密码。
*   `(<rule list>)`： (在 Redis 7.0 及更高版本中可) ) 创建新的选择器来匹配规则。选择器在用户权限之后进, 评估, 并根据定义的顺序进行评估。如果命令与用户权限或任何选择, 匹配, 则允许该命令。看[选择](/topics/acl#selectors)了解更多信息。
*   `clearselectors`： (在 Redis 7.0 及更高版本中可) ) 删除附加到用户的所有选择器。
*   `reset`：删除用户的任何功能。它被设置为关闭, 没有密码, 无法执行任何命令, 无法访问任何密钥。

@return

@simple字符串回复：`OK`关于成功。

如果规则包含错误, 则返回错误。

@examples

    > ACL SETUSER alan allkeys +@string +@set -SADD >alanpassword
    +OK

    > ACL SETUSER antirez heeyyyy
    (error) ERR Error in ACL SETUSER modifier 'heeyyyy': Syntax error
