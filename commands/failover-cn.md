此命令将启动当前连接到的主服务器与其副本之一之间的协调故障转移。
故障转移不是同步的, 而是后台任务将处理协调故障转移的过程。
它旨在限制故障转移期间群集的数据丢失和不可用。
此命令类似于`CLUSTER FAILOVER`命令, 用于非群集 Redis, 类似于 sentinel 提供的故障转移支持。

默认故障转移流的具体详细信息如下所示：

1.  主站将在内部启动`CLIENT PAUSE WRITE`, 这将暂停传入的写入并防止复制流中的新数据累积。
2.  主服务器将监视其副本, 等待副本指示它已完全使用复制流。如果主节点有多个副本, 则只会等待第一个副本赶上。
3.  然后, 主服务器将自己降级为副本。这样做是为了防止出现任何双主站方案。注意：主服务器不会丢弃其数据, 因此, 如果副本在下一步中拒绝故障转移请求, 它将能够回滚。
4.  上一个主站将向目标副本发送特殊的 PSYNC 请求, `PSYNC FAILOVER`, 指示目标副本成为主副本。
5.  一旦前一个主站收到确认, `PSYNC FAILOVER`被接受它将取消暂停其客户。如果 PSYNC 请求被拒绝, 主服务器将中止故障转移并恢复正常。

现场`master_failover_state`在`INFO replication`可用于跟踪故障转移的当前状态, 故障转移具有以下值：

*   `no-failover`：没有持续的协调故障转移。
*   `waiting-for-sync`：主服务器正在等待复制副本赶上其复制偏移量。
*   `failover-in-progress`：主服务器已降级, 并尝试将所有权移交给目标副本。

如果以前的主节点附加了其他副本, 它们将继续作为链接副本从该副本进行复制。您需要手动执行`REPLICAOF`以直接从新主服务器开始复制。

## 可选参数

存在以下可选参数来修改故障转移流的行为：

*   `TIMEOUT` *毫秒*-- 此选项允许指定主节点在`waiting-for-sync`状态, 然后中止故障转移尝试并回滚。
    这旨在为 Redis 集群可能遇到的写入中断设置上限。
    故障转移通常在不到一秒钟的时间内发生, 但如果存在大量写入流量或副本在使用复制流方面已经落后, 则可能需要更长的时间。
    如果未指定此值, 则可以将超时视为“无限”。

*   `TO` *主机* *港口*-- 此选项允许通过其主机和端口指定要故障转移到的特定副本。主服务器将专门等待此副本赶上其复制偏移量, 然后故障转移到该副本。

*   `FORCE`-- 如果两者都`TIMEOUT`和`TO`设置选项后, force 标志还可用于指定一旦超时, 主服务器应故障转移到目标副本, 而不是回滚。
    这可以用于尽最大努力尝试故障转移而不会丢失数据, 但限制写入中断。

注意：如果`PSYNC FAILOVER`请求被目标副本拒绝。

## 故障转移中止

故障转移命令旨在防止数据丢失和损坏, 但可能会遇到某些无法自动修复的情况, 并且可能会卡住。
为此, `FAILOVER ABORT`命令存在, 这将中止正在进行的故障转移并将主服务器返回到其正常状态。
如果在`waiting-for-sync`状态, 但可以在`failover-in-progress`州。
如果遇到多主服务器方案, 则需要手动确定哪个主服务器具有最新数据, 并将其指定为主服务器并拥有其他副本。

注意：`REPLICAOF`在故障转移过程中处于禁用状态, 这是为了防止与故障转移进行可能导致数据丢失的意外交互。

@return

@simple字符串回复：`OK`如果命令已被接受, 并且正在进行协调故障转移。如果无法执行操作, 则会出现错误。
