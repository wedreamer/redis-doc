Redis 集群中的每个节点都有其当前集群配置的视图，
由已知节点集给出，我们与此类节点的连接状态
节点、其标志、属性和分配的插槽等。

`CLUSTER NODES`提供所有这些信息，即当前群集
我们正在联系的节点的配置，以序列化格式
恰好与 Redis Cluster 本身在
在磁盘上存储群集状态（但是磁盘上的群集状态
在末尾附加了一些附加信息）。

请注意，通常客户端愿意获取群集之间的映射
哈希槽和节点地址应使用`CLUSTER SLOTS`相反。
`CLUSTER NODES`，提供更多信息，应用于
管理任务、调试和配置检查。
它也被使用`redis-cli`以便管理群集。

## 序列化格式

该命令的输出只是一个空格分隔的 CSV 字符串，其中
每行表示群集中的一个节点。下面是一个示例
输出数量：

    07c37dfeb235213a872192d90877d0cd55635b91 127.0.0.1:30004@31004 slave e7d1eecce10fd6bb5eb35b9f99a514335d9ba9ca 0 1426238317239 4 connected
    67ed2db8d677e59ec4a4cefb06858cf2a1a89fa1 127.0.0.1:30002@31002 master - 0 1426238316232 2 connected 5461-10922
    292f8b365bb7edb5e285caf0b7e6ddc7265d2f4f 127.0.0.1:30003@31003 master - 0 1426238318243 3 connected 10923-16383
    6ec23923021cf3ffec47632106199cb7f496ce01 127.0.0.1:30005@31005 slave 67ed2db8d677e59ec4a4cefb06858cf2a1a89fa1 0 1426238316232 5 connected
    824fe116063bc5fcf9f4ffd895bc17aee7731ac3 127.0.0.1:30006@31006 slave 292f8b365bb7edb5e285caf0b7e6ddc7265d2f4f 0 1426238317741 6 connected
    e7d1eecce10fd6bb5eb35b9f99a514335d9ba9ca 127.0.0.1:30001@31001 myself,master - 0 0 1 connected 0-5460

每行由以下字段组成：

    <id> <ip:port@cport> <flags> <master> <ping-sent> <pong-recv> <config-epoch> <link-state> <slot> <slot> ... <slot>

每个字段的含义如下：

1.  `id`：节点 ID，创建节点时生成的 40 个字符的随机字符串，并且永远不会再次更改（除非`CLUSTER RESET HARD`使用）。
2.  `ip:port@cport`：客户端应联系节点以运行查询的节点地址。
3.  `flags`：逗号分隔标志的列表：`myself`,`master`,`slave`,`fail?`,`fail`,`handshake`,`noaddr`,`nofailover`,`noflags`.下一节将详细解释标志。
4.  `master`：如果节点是副本，并且主节点是已知的，则主节点 ID，否则为“-”字符。
5.  `ping-sent`：发送当前活动 ping 的毫秒 unix 时间，如果没有挂起的 ping，则为零。
6.  `pong-recv`：毫秒 unix 时间收到最后一个 pong。
7.  `config-epoch`：当前节点（或当前主节点，如果节点是副本）的配置纪元（或版本）。每次发生故障转移时，都会创建一个新的、唯一的、单调递增的配置纪元。如果多个节点声称为相同的哈希槽提供服务，则具有较高配置纪元的节点获胜。
8.  `link-state`：用于节点到节点群集总线的链路的状态。我们使用此链接与节点进行通信。可以是`connected`或`disconnected`.
9.  `slot`：哈希槽号或范围。从参数 9 开始，但总共最多可能有 16384 个条目（从未达到限制）。这是此节点提供的哈希槽的列表。如果条目只是一个数字，则按此进行解析。如果它是一个范围，则其形式为`start-end`，并表示节点负责来自 的所有哈希槽`start`自`end`包括开始值和结束值。

标志的含义（字段编号 3）：

*   `myself`：您正在联系的节点。
*   `master`：节点是主节点。
*   `slave`：节点是副本。
*   `fail?`：节点位于`PFAIL`州。对于您正在联系的节点，不可访问，但在逻辑上仍可访问（不在`FAIL`状态）。
*   `fail`：节点位于`FAIL`州。对于提升`PFAIL`状态到`FAIL`.
*   `handshake`：不受信任的节点，我们正在握手。
*   `noaddr`：此节点没有已知的地址。
*   `nofailover`：副本不会尝试故障转移。
*   `noflags`：完全没有标志。

## 有关已发布的配置纪元的说明

副本广播其主节点的配置 epoch （为了获得`UPDATE`
消息，如果发现它们是过时的），所以真正的配置纪元
副本（这或多或少是没有意义的，因为它们不提供哈希槽）
只能获得检查标记为`myself`，这是条目
我们要求生成的节点的数量`CLUSTER NODES`输出。另一个
副本 epoch 反映了它们在检测信号数据包中发布的内容，即
它们当前正在复制的主节点的配置纪元。

## 特殊插槽条目

通常，与给定节点关联的哈希槽采用以下格式之一，
如上所述：

1.  单人号码：3894
2.  范围：3900-4000

但是，节点哈希槽可以处于特殊状态，用于在节点重新启动后（AOF/RDB 文件中的键与节点哈希槽配置之间的键不匹配）或正在进行重新分片操作时传达错误。这两种状态是**进口**和**迁移**.

Redis 规范中解释了这两种状态的含义，但是这两种状态的要点如下：

*   **进口**插槽尚未成为节点哈希插槽的一部分，正在进行迁移。仅当`ASK`命令被使用。
*   **迁移**插槽已分配给该节点，但正在迁移到某个其他节点。如果命令中的所有键都已存在，则节点将接受查询，否则它将发出所谓的**ASK 重定向**，以强制直接在导入节点中创建新键。

导入和迁移槽在`CLUSTER NODES`输出如下：

*   **导入插槽：** `[slot_number-<-importing_from_node_id]`
*   **迁移插槽：** `[slot_number->-migrating_to_node_id]`

以下是导入和迁移槽的几个示例：

*   `[93-<-292f8b365bb7edb5e285caf0b7e6ddc7265d2f4f]`
*   `[1002-<-67ed2db8d677e59ec4a4cefb06858cf2a1a89fa1]`
*   `[77->-e7d1eecce10fd6bb5eb35b9f99a514335d9ba9ca]`
*   `[16311->-292f8b365bb7edb5e285caf0b7e6ddc7265d2f4f]`

请注意，该格式没有任何空格，因此`CLUSTER NODES`输出格式是纯 CSV，即使发出此特殊插槽，也要使用空格作为分隔符。但是，格式的完整解析器应该能够处理它们。

请注意：

1.  迁移和导入槽仅添加到标记为`myself`.此信息是节点的本地信息，适用于其自己的插槽。
2.  导入和迁移插槽按如下方式提供**附加信息**.如果节点分配了给定的哈希槽，则该哈希槽列表中的哈希槽也是一个普通数字，因此对哈希槽迁移一无所知的客户端可以跳过此特殊字段。

@return

@bulk字符串回复：序列化的群集配置。

**关于此手册页中使用的单词 slave 和命令名称的说明**：从 Redis 5 开始，如果不是为了向后兼容，Redis 项目不再使用“从属”一词。不幸的是，在此命令中，单词 slave 是协议的一部分，因此只有当此 API 自然弃用时，我们才能删除此类事件。
