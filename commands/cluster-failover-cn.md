此命令只能发送到 Redis 集群副本节点，强制
用于启动其主实例的手动故障转移的副本。

手动故障转移是一种特殊的故障转移，通常在以下情况下执行：
没有实际的故障，但我们希望将当前主节点与一个主节点交换
以安全的方式将其副本（即我们向其发送命令的节点）
没有任何数据丢失窗口。它的工作方式如下：

1.  副本告诉主服务器停止处理来自客户端的查询。
2.  主服务器使用当前副本回复副本*复制偏移*.
3.  复制副本等待复制偏移量在其一侧匹配，以确保在继续之前处理了来自主服务器的所有数据。
4.  副本启动故障转移，从大多数主服务器获取新的配置纪元，并广播新配置。
5.  旧主服务器接收配置更新：取消阻止其客户端并开始回复重定向消息，以便它们继续与新主服务器聊天。

这样，客户端就会从旧的主服务器移动到新的主服务器
原子方式，并且仅当正在转换为新主副本时
已处理来自旧主服务器的所有复制流。

## FORCE 选项：主服务器停机时手动故障转移

可以通过两个选项修改命令行为：**力**和**收购**.

如果**力**选项，副本不执行任何握手
与主，这可能是无法到达的，而只是开始一个
从第 4 点开始尽快进行故障转移。当我们想要开始时，这很有用
在主服务器不再可访问时进行手动故障转移。

但是使用**力**我们仍然需要大多数大师可用
以授权故障转移并生成新的配置纪元
对于将成为主副本的副本。

## 接管选项：在没有群集共识的情况下手动故障转移

在某些情况下，这还不够，我们希望副本进行故障转移
与群集的其余部分没有任何协议。真实世界的用例
因为这是将不同数据中心的副本批量提升到主数据中心
为了在所有主站关闭时执行数据中心切换
或隔开。

这**收购**选项意味着一切**力**暗示，但也确实如此
不使用任何群集授权进行故障转移。副本接收
`CLUSTER FAILOVER TAKEOVER`将改为：

1.  生成新的`configEpoch`单方面，只是获取当前最大的可用纪元，如果其本地配置纪元还不是最大的，则递增它。
2.  为自己分配其主节点的所有哈希槽，并将新配置传播到可尽快访问的每个节点，并最终传播到所有其他节点。

请注意，**TAKEOVER 违反了最后一次故障转移获胜原则**的 Redis Cluster，因为副本生成的配置纪元在几个方面违反了配置纪元的正常生成：

1.  不能保证它实际上是更高的配置时代，因为，例如，我们可以使用**收购**少数派中的选项，也不执行任何消息交换来生成新的配置纪元。
2.  如果我们生成一个碰巧与另一个实例发生冲突的配置纪元，最终我们的配置纪元或具有相同纪元的另一个实例之一将使用*配置纪元冲突解决算法*.

正因为如此，**收购**选项应谨慎使用。

## 实现细节和说明

*   `CLUSTER FAILOVER`，除非**收购**选项，则不同步执行故障转移。
    它只*附表*手动故障转移，绕过故障检测阶段。
*   一`OK`回复不能保证故障转移会成功。
*   仅当集群中的大多数主服务器将副本称为副本时，才能将其提升为主服务器。
    如果副本是刚刚添加到群集的新节点（例如，在升级后），则群集中的所有主节点可能还不知道该副本。
    要检查主服务器是否知道新的副本，您可以发送`CLUSTER NODES`或`CLUSTER REPLICAS`在发送之前，向每个主节点发送并检查它是否显示为副本`CLUSTER FAILOVER`到复制副本。
*   若要检查故障转移是否确实发生，可以使用`ROLE`,`INFO REPLICATION`（表示成功故障转移后“角色：主服务器”），或`CLUSTER NODES`以验证发送命令后的某个时间群集的状态是否已更改。
*   若要检查故障转移是否失败，请检查副本的日志中是否有“手动故障转移超时”，如果副本在几秒钟后放弃，则会记录该日志。

@return

@simple字符串回复：`OK`如果该命令被接受，并且将尝试手动故障转移。如果无法执行操作，例如，如果我们正在与已经是主节点的节点通信，则会出现错误。
