在流使用者组的上下文中, 此命令更改所有权
, 以便新所有者是指定为
命令参数。通常情况下, 情况如下：

1.  存在具有关联使用者组的流。
2.  某些使用者 A 通过以下方式读取消息`XREADGROUP`从流, 在该使用者组的上下文中。
3.  作为副作用, 在使用者组的挂起条目列表  (PEL)  中创建挂起的消息条目：这意味着消息已传递给给定的使用者, 但尚未通过以下方式确认`XACK`.
4.  然后突然之间, 那个消费者永远地失败了。
5.  其他使用者可能会检查挂起的消息列表, 这些消息在相当长的一段时间内已经过时, 使用`XPENDING`命令。为了继续处理此类消息, 他们使用`XCLAIM`以获取消息的所有权并继续。消费者也可以使用`XAUTOCLAIM`命令以自动扫描和声明过时的挂起邮件。

这种动态在[流介绍文档](/topics/streams-intro).

请注意, 仅当消息的空闲时间大于我们在调用时指定的最小空闲时间时, 才会声明该消息`XCLAIM`.因为作为副作用`XCLAIM`还将重置空闲时间 (因为这是处理消息的新尝试) , 两个使用者尝试同时声明消息永远不会都成功：只有一个会成功。这避免了我们以一种微不足道的方式多次处理给定的消息 (但在一般情况下, 多次处理是可能的, 也是不可避免的) 。

此外, 作为副作用, `XCLAIM`将增加邮件的尝试传递计数, 除非`JUSTID`选项 (仅传递消息 ID, 而不传递消息本身) 。通过这种方式, 由于某种原因无法处理的消息, 例如, 因为消费者崩溃试图处理它们, 将开始有一个更大的计数器, 并且可以在系统内部检测到。

`XCLAIM`在以下情况下不会声明消息：

1.  该消息不存在于 PEL 组中 (即, 它从未被任何使用者读取过) 
2.  消息存在于组 PEL 中, 但不存在于流本身中 (即, 消息已被读取但从未被确认, 然后通过修剪或由`XDEL`)

在这两种情况下, 回复都不会包含该消息的相应条目 (即, 回复数组的长度可能小于提供给`XCLAIM`).
在后一种情况下, 邮件也将从找到该邮件的 PEL 中删除。此功能是在 Redis 7.0 中引入的。

## 命令选项

该命令具有多个选项, 但大多数主要用于内部使用
为了转移效果`XCLAIM`或对 AOF 文件的其他命令
并将相同的效果传播到复制品, 并且不太可能
对普通用户有用：

1.  `IDLE <ms>`：设置邮件的空闲时间 (上次传递时间) 。如果未指定 IDLE, 则假定 IDLE 为 0, 即重置时间计数, 因为现在有新的所有者尝试处理该消息。
2.  `TIME <ms-unix-time>`：这与 IDLE 相同, 但它不是相对毫秒数, 而是将空闲时间设置为特定的 Unix 时间 (以毫秒为单位) 。这对于重写AOF文件生成非常有用`XCLAIM`命令。
3.  `RETRYCOUNT <count>`：将重试计数器设置为指定的值。每次再次传递消息时, 此计数器都会递增。通常`XCLAIM`不会更改此计数器, 该计数器仅在调用 XPENDING 命令时提供给客户端：这样客户端可以检测异常, 例如在大量传递尝试后由于某种原因从未处理的消息。
4.  `FORCE`：在 PEL 中创建挂起的消息条目, 即使分配给其他客户端的 PEL 中尚未包含某些指定的 ID。但是, 消息必须存在于流中, 否则将忽略不存在消息的 ID。
5.  `JUSTID`：仅返回已成功声明的消息的 ID 数组, 而不返回实际消息。使用此选项意味着重试计数器不会递增。

@return

@array回复, 具体而言：

该命令以相同的格式返回成功声明的所有消息
如`XRANGE`.但是, 如果`JUSTID`选项, 仅指定消息
报告 ID, 但不包括实际消息。

@examples

    > XCLAIM mystream mygroup Alice 3600000 1526569498055-0
    1) 1) 1526569498055-0
       2) 1) "message"
          2) "orange"

在上面的示例中, 我们使用 ID 声明消息`1526569498055-0`, 仅当消息空闲至少一小时而原始使用者或其他使用者未取得进展 (确认或声明) 时, 并将所有权分配给使用者`Alice`.
