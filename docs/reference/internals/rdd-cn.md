***

标题：“Redis 设计草案 #2（历史）”
链接标题： “Redis 设计草案”
体重： 2
描述： 在Redis早期编写的RDB格式设计
别名：

*   /topics/rdd
*   /topics/rdd-1
*   /topics/rdd-2

***

**注意：本文档由Redis的创建者Salvatore Sanfilippo撰写，在Redis开发早期（约2013年），作为一系列设计草案的一部分。这是为了历史利益而保留的。**

# Redis 设计草案 2 -- RDB 版本 7 信息字段

*   作者： 萨尔瓦多·桑菲利波`antirez@gmail.com`
*   GitHub 问题[#1048](https://github.com/redis/redis/issues/1048)

## 修订历史

1.0， 10 四月 2013 - 初稿.

## 概述

Redis RDB 格式缺少将信息字段添加到 RDB 文件的简单方法
即使添加了元数据，也不会导致向后兼容性问题
不需要从 RDB 文件加载数据。

例如，由于本文档中指定的信息字段，它将
可以添加到RDB信息，如文件创建时间，Redis版本
生成文件以及任何其他有用信息的方式
要正确处理 RDB 版本 7 文件，每个字段都是必需的。

此外，只需进行最少的更改，就可以将 RDB 版本 7 支持添加到
Redis 2.6 实际上不支持其他字段，只是跳过
它们在加载 RDB 文件时显示。

如果需要，RDB信息字段可以具有语义含义，以便存在
的字段可以添加有关 RDB 中指定的数据集的信息
文件格式，但是当需要正确解码信息字段时
为了理解和加载RDB文件的数据集内容，
必须增加 RDB 文件格式，以便以前版本的 Redis 不会
尝试加载它。

但是，目前信息字段设计为仅包含其他字段
对加载数据集没有用但可以更好地指定的信息
RDB 文件的创建方式。

## 信息字段表示

RDB 格式 6 具有以下布局：

*   一个 9 字节的魔术“REDIS0006”
*   键值对
*   EOF 操作码
*   CRC64 校验和

RDB 格式 7 的建议是立即添加可选字段
在前9个字节之后魔术，所以新的格式将是：

*   一个 9 字节的魔术“REDIS0007”
*   信息字段 1
*   信息字段 2
*   ...
*   信息字段 N
*   信息字段字段末尾
*   键值对
*   EOF 操作码
*   CRC64 校验和

每个信息字段都具有以下结构：

*   16 位标识符
*   64 位数据长度
*   指定的确切长度的数据部分

标识符和数据长度都存储在小字节序字节中
订购。

特殊标识符 0 表示没有其他信息字段，并且
RDB 文件的其余部分包含键值对。

## 信息字段的处理

程序可以简单地跳过它不理解的每个信息字段，只要
因为RDB版本与它能够加载的版本相匹配。

## 信息字段 ID 和内容的规范。

### 信息字段 0 -- 信息字段的结尾

这只是意味着不再有要处理的信息字段。

### 信息字段 1 -- 创建日期

此字段表示创建 RDB 文件的 unix 时间。
unix 时间的格式是一个 64 位小端整数，表示
自1970年1月1日起的秒数。

### 信息字段 2 -- Redis 版本

此字段表示包含 Redis 版本的空终止字符串
生成文件，如 Redis 版本 INFO 字段中所示。
