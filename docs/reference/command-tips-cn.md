---
title: "Redis command tips"
linkTitle: "Command tips"
weight: 1
description: Programm
aliases:
    - /topics/command-tips
---

命令提示是字符串的数组。
它们为 Redis 客户端提供有关命令的其他信息。
该信息可以指示 Redis 集群客户端在集群部署中应如何执行命令及其输出。

与命令的标志不同（请参阅`COMMAND`的回复），严格限于服务器操作的内部，提示除了报告给客户端之外没有任何作用。

命令提示是任意字符串。
但是，以下各节介绍了建议的提示，并演示了它们可能遵守的约定。

## nondeterministic_output

此提示指示命令的输出不是确定性的。
这意味着对命令的调用可能会产生具有不同的参数和数据的不同结果。
这种差异可能是命令的随机性质的结果（例如，`RANDOMKEY`和`SPOP`);呼叫的时间（例如`TTL`);或与服务器状态相关的一般差异（例如`INFO`和`CLIENT LIST`).

**注意：**
在 Redis 7.0 之前，这个提示是*随机*命令标志。

## nondeterministic_output_order

此提示的存在表明命令的输出是确定性的，但其排序是随机的（例如`HGETALL`和`SMEMBERS`).

**注意：**
在 Redis 7.0 之前，这个提示是*排序*\_*为*\_*脚本*旗。

## request_policy

此提示可帮助客户端确定要在集群模式下发送命令的分片。
客户端应为没有*request_policy*提示如下：

1.  该命令不接受键名参数：客户端可以在任意分片上执行命令。
2.  对于接受一个或多个键名参数的命令：客户端应将命令路由到单个分片，由输入键的哈希槽确定。

如果客户端应采用与默认行为不同的行为，则*request_policy*提示可以是以下之一：

*   **all_nodes：**客户端应该在所有节点上执行命令 - 主节点和副本节点相同。
    一个例子是`CONFIG SET`命令。
    不接受键名参数的命令正在使用此提示。
    该命令按分片以原子方式运行。

<!---->

*   **all_shards：**客户端应该在所有主分片上执行命令（例如，`DBSIZE`命令）。
    不接受键名参数的命令正在使用此提示。
    该命令按分片以原子方式运行。

<!---->

*   **multi_shard：**客户端应在多个分片上执行命令。
    执行命令的分片由其输入键名参数的哈希槽确定。
    此类命令的示例包括`MSET`,`MGET`和`DEL`.
    但是，请注意`SUNIONSTORE`不被视为*multi_shard*因为它的所有密钥必须属于同一个哈希槽。
*   **特殊：**表示客户端请求策略的非平凡形式，例如`SCAN`命令。

## response_policy

此提示可以帮助客户端根据集群中多个分片的回复确定他们需要计算的聚合。
不带*request_policy*提示仅适用于具有嵌套类型（即数组、集合或映射）的回复。
客户端对默认行为的实现应如下所示：

1.  该命令不接受键名参数：客户端可以在单个嵌套数据结构中聚合所有回复。
    例如，我们从调用中获得的数组回复`KEYS`针对所有分片。
    这些应该以单一的顺序包装，没有特定的顺序。
2.  对于接受一个或多个键名参数的命令：客户端需要保留与输入键名相同的回复顺序。
    例如`MGET`的聚合回复。

这*response_policy*提示是为使用标量数据类型进行回复的命令设置的，或者当期望客户端实现非默认聚合时设置提示。
此提示可以是以下技巧之一：

*   **one_succeeded：**如果至少有一个分片没有回复错误，则客户端应返回成功。
    客户端应使用它获得的第一个非错误答复进行答复。
    如果所有分片都返回错误，则客户端可以使用其中任何一个进行回复。
    例如，考虑`SCRIPT KILL`发送到所有分片的命令。
    尽管脚本应加载到集群的所有分片中，但`SCRIPT KILL`在给定时间通常只在一个上运行。
*   **all_succeeded：**仅当没有错误回复时，客户端才应成功返回。
    即使只有一个错误回复，也应该取消聚合的资格并返回。
    否则，客户端应返回其中一个非错误答复。
    例如，考虑`CONFIG SET`,`SCRIPT FLUSH`和`SCRIPT LOAD`命令。
*   **agg_logical_and：**客户端应返回逻辑的结果*和*对所有回复执行操作（仅适用于整数回复，通常来自返回*0*或*1*).
    考虑`SCRIPT EXISTS`命令作为示例。
    它返回一个数组*0*的和*1*表示脚本缓存中存在其给定的 SHA1 和。
    聚合响应应为*1*仅当所有分片都报告给定的脚本 SHA1 总和位于其各自的缓存中时。
*   **agg_logical_or：**客户端应返回逻辑的结果*和*对所有回复执行操作（仅适用于整数回复，通常来自返回*0*或*1*).
*   **agg_min：**客户端应返回回复中的最小值（仅适用于数字回复）。
    来自群集范围的聚合答复`WAIT`例如，命令应该是所有分片的最小值（同步副本数）。
*   **agg_max：**客户端应从回复中返回最大值（仅适用于数字回复）。
*   **agg_sum：**客户端应返回回复的总和（仅适用于数字回复）。
    例：`DBSIZE`.
*   **特殊：**这种类型的提示表示一种不平凡的答复策略形式。
    `INFO`就是一个很好的例子。

## 例

    redis> command info ping
    1)  1) "ping"
        2) (integer) -1
        3) 1) fast
        4) (integer) 0
        5) (integer) 0
        6) (integer) 0
        7) 1) @fast
           2) @connection
        8) 1) "request_policy:all_shards"
           2) "response_policy:all_succeeded"
        9) (empty array)
       10) (empty array)
